require.config({paths:{async:"++resource++plone.formwidget.geolocation/async"}}),require(["jquery"],function(a){var b=a("body").data("portalUrl");a.getJSON(b+"/@@load-maps-api-key").then(function(b){require(["async!http://maps.google.com/maps/api/js?v=3&libraries=places&key="+b.key],function(){function b(b){a.each(b,function(){a(this).attr("readonly",!0)})}function c(a,b,c,d,e,f){var g=a.getPosition(),h=g.lat(),i=g.lng();b.val(h),c.val(i),zoomLevel=f.getZoom(),d.val(zoomLevel),e.data("latitude",h),e.data("longitude",i)}function d(a,b,c,d){0===a&&0===b&&navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){d.setCenter({lat:a.coords.latitude,lng:a.coords.longitude})}):d.setCenter({lat:a,lng:b}),d.setZoom(c)}a(document).on("geowidget:init",function(e){var f=a(e.target);if(!f.data("geolocationfield")){f.data("geolocationfield",!0);var g=f.is(".edit");a(".geolocation-data",f).hide();var h=a(".geolocation",f),i=a(".geolocationfield-field.latitude",f),j=a(".geolocationfield-field.longitude",f),k=a(".geolocationfield-field.zoom",f);if(g)var l=parseFloat(i.val()),m=parseFloat(j.val()),n=parseInt(k.val(),10);else var l=parseFloat(h.data("latitude")),m=parseFloat(h.data("longitude")),n=parseInt(h.data("zoom"),10);var o=new google.maps.Map(h.get(0));d(l,m,n,o),h.addClass("mapActive").css({width:"100%",height:"400px"});var p=new google.maps.LatLng(l,m),q=new google.maps.Marker({map:o,anchorPoint:new google.maps.Point(0,(-29)),draggable:g,animation:google.maps.Animation.DROP});if(q.setPosition(p),g){b([i,j]);var r=a(".map-search-input",f);r.show(),google.maps.event.addDomListener(r.get(0),"keydown",function(a){13===a.keyCode&&(a.preventDefault(),a.stopPropagation())});var s=new google.maps.places.Autocomplete(r.get(0));s.bindTo("bounds",o),google.maps.event.addListener(o,"zoom_changed",function(){zoomLevel=o.getZoom(),k.val(zoomLevel)});var t=a(".infowindow-content",f),u=new google.maps.InfoWindow,v=t.get(0);u.setContent(v),s.addListener("place_changed",function(){u.close(),q.setVisible(!1);var a=s.getPlace();if(a.geometry){a.geometry.viewport?o.fitBounds(a.geometry.viewport):(o.setCenter(a.geometry.location),o.setZoom(n)),q.setPosition(a.geometry.location),q.setVisible(!0);var b="";a.address_components&&(b=[a.address_components[0]&&a.address_components[0].short_name||"",a.address_components[1]&&a.address_components[1].short_name||"",a.address_components[2]&&a.address_components[2].short_name||""].join(" "),c(q,i,j,k,h,o)),t.find(".place-icon").attr("src",a.icon),t.find(".place-name").text(a.name),t.find(".place-address").text(b),u.open(o,q)}}),q.addListener("dragend",function(a){c(q,i,j,k,h,o)})}}}),a(".geolocation_wrapper.edit,.geolocation_wrapper.view").trigger("geowidget:init")})})}),define("/Users/keul/buildout/test5.1/src/plone.formwidget.geolocation/plone/formwidget/geolocation/browser/static/plone.formwidget.geolocation.js",function(){});
//# sourceMappingURL=compiled-plone-formwidget-geolocation.js.map